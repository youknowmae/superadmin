<main>
  <div class="container">
    <div class="details-content">
      <div class="header">
        <h1>Add Industry Partner</h1>
        <i class="fa-solid fa-xmark" (click)="closePopup()"></i>
      </div>

      <div class="page-content">
        <mat-stepper #stepper linear="true">
          <!-- Step 1: Company Profile -->
          <mat-step [stepControl]="formDetails" label="Company Profile">
            <form [formGroup]="formDetails">
              <div class="form-content">
                <h3>Company Name</h3>

                <div class="row">
                  <div class="col-md-4">
                    <div class="file-input-container">
                      <div class="label">Upload Image</div>
                      <input
                        class="file-input"
                        type="file"
                        accept=".jpeg, .png, .jpg, .svg"
                        (change)="uploadFile($event)"
                      />
                    </div>
                  </div>

                  <div class="col-md-8">
                    <mat-form-field>
                      <mat-label>Name of Company</mat-label>
                      <input matInput formControlName="company_name" />
                    </mat-form-field>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-12">
                    <mat-form-field>
                      <mat-label>Description</mat-label>
                      <textarea
                        matInput
                        cdkTextareaAutosize
                        #autosize="cdkTextareaAutosize"
                        cdkAutosizeMinRows="2"
                        cdkAutosizeMaxRows="2"
                        formControlName="description"
                      ></textarea>
                    </mat-form-field>
                  </div>
                </div>

                <h3>Company Head</h3>

                <div class="row" formGroupName="company_head">
                  <div class="col-md-3">
                    <mat-form-field>
                      <mat-label>First Name</mat-label>
                      <input matInput formControlName="first_name" />
                    </mat-form-field>
                  </div>

                  <div class="col-md-2">
                    <mat-form-field>
                      <mat-label>Middle Name</mat-label>
                      <input matInput formControlName="middle_name" />
                    </mat-form-field>
                  </div>

                  <div class="col-md-3">
                    <mat-form-field>
                      <mat-label>Last Name</mat-label>
                      <input matInput formControlName="last_name" />
                    </mat-form-field>
                  </div>

                  <div class="col-md-2">
                    <mat-form-field [floatLabel]="'always'">
                      <mat-label>Suffix</mat-label>
                      <mat-select formControlName="ext_name" placeholder="None">
                        <mat-option [value]="null">None</mat-option>
                        <mat-option
                          *ngFor="let title of titles"
                          [value]="title"
                        >
                          {{ title }}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>

                  <div class="col-md-2">
                    <mat-form-field [floatLabel]="'always'">
                      <mat-label>Sex</mat-label>
                      <mat-select formControlName="sex" placeholder="None">
                        <mat-option [value]="'1'">Male</mat-option>
                        <mat-option [value]="'0'">Female</mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-2">
                    <mat-form-field>
                      <mat-label>Position</mat-label>
                      <input matInput formControlName="head_position" />
                    </mat-form-field>
                  </div>
                </div>

                <h3>
                  Immediate Supervisor
                  <span style="font-size: 14px; font-weight: 300; opacity: 0.7"
                    >*This can be the same as Company head</span
                  >
                </h3>

                <div class="row" formGroupName="immediate_supervisor">
                  <div class="col-md-3">
                    <mat-form-field>
                      <mat-label>First Name</mat-label>
                      <input matInput formControlName="first_name" />
                    </mat-form-field>
                  </div>

                  <div class="col-md-2">
                    <mat-form-field>
                      <mat-label>Middle Name</mat-label>
                      <input matInput formControlName="middle_name" />
                    </mat-form-field>
                  </div>

                  <div class="col-md-3">
                    <mat-form-field>
                      <mat-label>Last Name</mat-label>
                      <input matInput formControlName="last_name" />
                    </mat-form-field>
                  </div>

                  <div class="col-md-2">
                    <mat-form-field [floatLabel]="'always'">
                      <mat-label>Suffix</mat-label>
                      <mat-select formControlName="ext_name" placeholder="None">
                        <mat-option [value]="null">None</mat-option>
                        <mat-option
                          *ngFor="let title of titles"
                          [value]="title"
                        >
                          {{ title }}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>

                  <div class="col-md-2">
                    <mat-form-field [floatLabel]="'always'">
                      <mat-label>Sex</mat-label>
                      <mat-select formControlName="sex" placeholder="None">
                        <mat-option [value]="'1'">Male</mat-option>
                        <mat-option [value]="'0'">Female</mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-2">
                    <mat-form-field>
                      <mat-label>Position</mat-label>
                      <input matInput formControlName="supervisor_position" />
                    </mat-form-field>
                  </div>
                </div>

                <h3>Address</h3>

                <div class="row">
                  <div class="col-md-3">
                    <mat-form-field>
                      <mat-label>Region</mat-label>
                      <mat-select
                        #region
                        formControlName="region"
                        (selectionChange)="onRegionChange(region.value)"
                      >
                        <mat-option
                          [value]="region"
                          *ngFor="let region of regions"
                        >
                          {{ region.regDesc }}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>

                  <div class="col-md-3">
                    <mat-form-field>
                      <mat-label>Province</mat-label>
                      <mat-select
                        #province
                        formControlName="province"
                        (selectionChange)="onProvinceChange(province.value)"
                      >
                        <mat-option
                          [value]="province"
                          *ngFor="let province of provinces"
                        >
                          {{ province.provDesc }}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>

                  <div class="col-md-3">
                    <mat-form-field>
                      <mat-label>Municipality</mat-label>
                      <mat-select
                        #municipality
                        formControlName="municipality"
                        (selectionChange)="
                          onMunicipalityChange(municipality.value)
                        "
                      >
                        <mat-option
                          [value]="municipality"
                          *ngFor="let municipality of municipalities"
                        >
                          {{ municipality.citymunDesc }}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>

                  <div class="col-md-3">
                    <mat-form-field>
                      <mat-label>Barangay</mat-label>
                      <mat-select #barangay formControlName="barangay">
                        <mat-option
                          [value]="barangay"
                          *ngFor="let barangay of barangays"
                        >
                          {{ barangay.brgyDesc }}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-5">
                    <mat-form-field>
                      <mat-label>House No./Lot No./Street Name</mat-label>
                      <input matInput formControlName="street" />
                    </mat-form-field>
                  </div>
                </div>

                <h3>Contact Information</h3>

                <div class="row">
                  <div class="col-md-4">
                    <mat-form-field>
                      <mat-label>Telephone Number</mat-label>
                      <input matInput formControlName="telephone_number" />
                    </mat-form-field>
                  </div>

                  <div class="col-md-4">
                    <mat-form-field>
                      <mat-label>Mobile Number</mat-label>
                      <input matInput formControlName="mobile_number" />
                    </mat-form-field>
                  </div>

                  <div class="col-md-4">
                    <mat-form-field>
                      <mat-label>Fax Number</mat-label>
                      <input matInput formControlName="fax_number" />
                    </mat-form-field>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-4">
                    <mat-form-field>
                      <mat-label>Email Address</mat-label>
                      <input matInput formControlName="email" />
                    </mat-form-field>
                  </div>

                  <div class="col-md-4">
                    <mat-form-field>
                      <mat-label>URL/Website</mat-label>
                      <input matInput formControlName="website" />
                      <mat-hint>*This can be any social media page</mat-hint>
                    </mat-form-field>
                  </div>
                </div>

                <h3>Slots</h3>

                <div class="row">
                  <div class="col-md-4">
                    <mat-form-field>
                      <mat-label>Number of Slots</mat-label>
                      <input matInput formControlName="slots" />
                    </mat-form-field>
                  </div>
                </div>

                <h3>Account Details</h3>

                <div class="row">
                  <div class="col-md-4">
                    <mat-form-field>
                      <mat-label>Email</mat-label>
                      <input
                        matInput
                        [value]="formDetails.get('email')?.value"
                        readonly=""
                      />
                    </mat-form-field>
                  </div>

                  <div class="col-md-4">
                    <mat-form-field>
                      <mat-label>Password</mat-label>
                      <input
                        [type]="showPassword ? 'text' : 'password'"
                        matInput
                        formControlName="password"
                      />
                      <mat-icon
                        matSuffix
                        (click)="showPassword = !showPassword"
                      >
                        {{ showPassword ? "visibility" : "visibility_off" }}
                      </mat-icon>
                    </mat-form-field>
                  </div>
                </div>

                <div class="btn" style="margin-top: 1rem">
                  <button mat-button matStepperNext>Next</button>
                </div>
              </div>
            </form>
          </mat-step>

          <!-- Step 2: MOU/MOA Upload -->
          <mat-step label="MOU/MOA">
            <div class="upload-box">
              <form [formGroup]="mouFormDetails">
                <div class="date-inputs" style="display: flex; gap: 1rem">
                  <mat-form-field appearance="fill" style="flex: 1">
                    <mat-label>Start Date</mat-label>
                    <input
                      matInput
                      [matDatepicker]="mouStartDatePicker"
                      formControlName="start_date"
                      readonly
                    />

                    <mat-datepicker-toggle
                      matIconSuffix
                      [for]="mouStartDatePicker"
                    ></mat-datepicker-toggle>
                    <mat-datepicker #mouStartDatePicker></mat-datepicker>
                  </mat-form-field>

                  <mat-form-field appearance="fill" style="flex: 1">
                    <mat-label>End Date</mat-label>
                    <input
                      matInput
                      [matDatepicker]="mouExpiryDatePicker"
                      formControlName="expiration_date"
                      readonly
                    />

                    <mat-datepicker-toggle
                      matIconSuffix
                      [for]="mouExpiryDatePicker"
                      [disabled]="mouFormDetails.get('endDate')?.disabled"
                    ></mat-datepicker-toggle>
                    <mat-datepicker #mouExpiryDatePicker></mat-datepicker>
                  </mat-form-field>
                </div>

                <p style="color: red; font-size: 12px; font-style: italic">
                  <b>Note: </b>The Validity of MOU is 1 year by default
                </p>
              </form>
              <h3>Upload MOU/MOA</h3>

              <div
                class="drop-zone"
                (drop)="onDrop($event)"
                (dragover)="onDragOver($event)"
                (dragleave)="onDragLeave($event)"
                [class.dragover]="isDragOver"
              >
                <input
                  type="file"
                  hidden
                  (change)="onFileSelected($event)"
                  #fileInput
                />
                <p>
                  Drop your files here,
                  <a
                    href="#"
                    (click)="fileInput.click(); $event.preventDefault()"
                    >or click to browse</a
                  >
                </p>
                <p class="file-types">
                  Supported files: .docx, .png, .webp, .cvs, .txt, .zip
                </p>
                <p class="file-size">Maximum size: 10MB</p>

                <div *ngIf="selectedFile" class="file-preview">
                  <div *ngIf="filePreviewUrl">
                    <img [src]="filePreviewUrl" alt="Preview" />
                  </div>

                  <div *ngIf="!filePreviewUrl">
                    <p><strong>Selected File:</strong> {{ fileName }}</p>
                  </div>
                </div>
              </div>

              <div class="btn" style="margin-top: 1rem; gap: 15px">
                <button mat-raised-button color="primary" matStepperPrevious>
                  Back
                </button>
                <button
                  mat-raised-button
                  color="accent"
                  [disabled]="mouFormDetails.invalid"
                  (click)="submit()"
                >
                  Create
                </button>
              </div>
            </div>
          </mat-step>
        </mat-stepper>
      </div>
    </div>
  </div>
</main>
